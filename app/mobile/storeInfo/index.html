<!DOCTYPE html>
<html>
<head>
<title>店铺</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no,width=320,target-densitydpi=142">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link href="../../resources/mobile/css/common.css" tppabs="http://www.mo-co.com/resources/mobile/css/common.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../resources/mobile/js/jquery.min.js" tppabs="http://www.mo-co.com/resources/mobile/js/jquery.min.js"></script>
<script type="text/javascript" src="../../resources/mobile/js/common.js" tppabs="http://www.mo-co.com/resources/mobile/js/common.js"></script>
<script type="text/javascript" src="../../resources/mobile/js/mobile.js" tppabs="http://www.mo-co.com/resources/mobile/js/mobile.js"></script>
<script type="text/javascript" src="../../../api.map.baidu.com/api-v=2.0&ak=9NRLHTxsqi5LDPpmLxwoTcCy" tppabs="http://api.map.baidu.com/api?v=2.0&ak=9NRLHTxsqi5LDPpmLxwoTcCy"></script>
<script src="../../../res.wx.qq.com/open/js/jweixin-1.0.0.js" tppabs="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="../../resources/mobile/js/coordinateConversor.js" tppabs="http://www.mo-co.com/resources/mobile/js/coordinateConversor.js"></script>
<script type="text/javascript">
$().ready(function(){ 
	m$.storeInfo.searchArea.getProvince();
	var $storeinformationsearch = $("#storeinformationsearch");
	$storeinformationsearch.click(function(){
		m$.storeInfo.searchArea.submit();
	});
	//Test
	/*$("#nearbySearchTest").click(function(){
        var googleCoordinate = GPS.bd_decrypt(32.015136827495,118.77445094453);
        var latitude = googleCoordinate['lat'];
        var longitude = googleCoordinate['lon'];
		document.location.href = moshop.base + '/mobile/storeInfo/getNearbyStoreList.jhtml?latitude='+latitude+'&longitude='+longitude+'&cityName='+'南京市'+'&brandId=19';
	});*/
});
function getCity(parentId) {
    m$.storeInfo.searchArea.getCity(parentId);
}
</script>
</head>
<body>
<div class="fullscreen">
<div>
<img src="../../resources/mobile/images/shop.jpg" tppabs="http://www.mo-co.com/resources/mobile/images/shop.jpg" style="width: 100%;"/>
</div>
<form id="inputForm" action="javascript:if(confirm('http://www.mo-co.com/mobile/storeInfo/getStoreList.jhtml?selectProvinceValue=&selectCityValue=  \n\nكτݾϞרԃ Teleport Ultra Ђ՘, ӲΪ ؾϱǷѨ٦עʺխϳ, بֹЂ՘c  \n\nţЫ՚ؾϱǷʏղߪ̼?'))window.location='http://www.mo-co.com/mobile/storeInfo/getStoreList.jhtml?selectProvinceValue=&selectCityValue='" tppabs="http://www.mo-co.com/mobile/storeInfo/getStoreList.jhtml?selectProvinceValue=&selectCityValue=" method="get" style="margin:12px;">
<div>
<ul>
<li>
<div class="select_box_p" style="width: 100%;">
<span id="store_select_txt_provice" class="select_txt">省</span>
<a class="selet_open" id="selectOpenProvice" style="height: 30px;">
<b></b>
</a>
<div id="provice_select_p" class="option_p" style="width: 100%;">
</div>
</div>
<br clear="all" />
</li>
<li>
<div class="select_box_b2" style="width: 100%;">
<span id="select_txt_city_b" class="select_txt">城市</span>
<a class="selet_open" id="selectOpenCity" style="height: 30px;">
</a>
<div id="city_select_b" class="option_b2" style="width: 100%;">
</div>
</div>
</li>
</ul>
<input type="hidden" id="selectProvinceValue" name="selectProvinceValue"/>
<input type="hidden" id="selectCityValue" name="selectCityValue"/>
<div>
<button type="button" id="storeinformationsearch" style="margin-top:10px;">搜索</button>
</div>
<div>
<input id="cityName" type="hidden" value=""/>
<button type="button" id="nearbySearch" style="margin-top:10px;margin-bottom:100px;">附近的MO店铺</button>
</div>
</form>
</div>
<nav class="footer" id="footer">
<a href="../mobileIndex.jhtml.htm" tppabs="http://www.mo-co.com/mobile/product/productCategory.jhtml?brandId=&tagIds=" id="navCategory" class="navCategory">
<em></em>
</a>
<a href="../cart/index.jhtml.htm" tppabs="http://www.mo-co.com/mobile/cart/index.jhtml" id="navCart" class="navCart">
<em>
<li id="navCartQuantity">
</li>
</em>
</a>
<a href="../login/index.jhtml.htm" tppabs="http://www.mo-co.com/mobile/login/index.jhtml" id="navAccount" class="navAccount">
<em></em>
</a>
<a href="index.jhtml.htm" tppabs="http://www.mo-co.com/mobile/storeInfo/index.jhtml" id="navStoreInfo" class="navStoreInfo">
<em></em>
</a>
<a href="../search/search.jhtml.htm" tppabs="http://www.mo-co.com/mobile/search/search.jhtml" id="navSearch" class="navSearch">
<em></em>
</a>
</nav>
<span style="display: none;">
<script type="text/javascript" src="../../../pw.cnzz.com/c.php-id=1251613148&l=2" tppabs="http://pw.cnzz.com/c.php?id=1251613148&l=2" charset="gb2312"></script>
</span>
</div>
</body>
<script type="text/javascript">
  window.onload = function(){
     wx.config({
	    debug: false, //开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
	    appId: 'wx222cbd523cae37f0', //必填，公众号的唯一标识
	    timestamp: '1466491892', // 必填，生成签名的时间戳
	    nonceStr: '1614c879-de92-4e5d-ae12-8b00b7bd1d44', // 必填，生成签名的随机串
	    signature: '10e826c160fedac2a6baa94ad49f0d4241134fa7',// 必填，签名
	    jsApiList: [
	      'getLocation' 
	    ] // 必填，需要使用的JS接口列表
	});
  }
  wx.ready(function () {
		$("#nearbySearch").click(function(){
		    wx.getLocation({
		    	type: 'wgs84', //默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
		    	//WGS-84：是国际标准，GPS坐标（Google Earth使用、或者GPS模块）
				//GCJ-02：中国坐标偏移标准，Google Map、高德、腾讯使用
			    //BD-09：百度坐标偏移标准，Baidu Map使用
		    	success: function (res) {
		    		var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
			        var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
			        var speed = res.speed; // 速度，以米/每秒计
			        var accuracy = res.accuracy; // 位置精度
			        var baiduCoordinate = GPS.bd_encrypt(latitude,longitude);//使用百度坐标定位当前城市
			        var googleCoordinate = GPS.gcj_encrypt(latitude,longitude);//传到后台使用的是google坐标
			        getCityName(baiduCoordinate['lat'],baiduCoordinate['lon']);
			        var cityName = $("#cityName").val();
			        //alert('/mobile/storeInfo/getNearbyStoreList.jhtml?latitude='+googleCoordinate['lat']+'&longitude='+googleCoordinate['lon']+'&cityName='+cityName+'&brandId=18');
			        document.location.href = moshop.base + '/mobile/storeInfo/getNearbyStoreList.jhtml?latitude='+googleCoordinate['lat']+'&longitude='+googleCoordinate['lon']+'&cityName='+cityName+'&brandId=18';
		    	},
		        cancel: function (res) {
		        	alert('用户拒绝授权获取地理位置');
		        }
	        });
		});
    });
    
    wx.error(function (res) {
	  	//alert(res.errMsg);
	  	m$.ui.dialog.dialogShow({
        	'title': '提示',
        	'content': res.errMsg
    		},
        [{
        'text': '确定'
        }]);
	});
    
	//定位当前省份、城市、区、街道(使用百度地图API，将经纬度转换成城市名和街道地址)
	function getCityName(latitude, longitude) {
		$.ajax({
			url: 'http://api.map.baidu.com/geocoder/v2/?ak=9NRLHTxsqi5LDPpmLxwoTcCy&callback=renderReverse&location=' + latitude + ',' + longitude + '&output=json&pois=1',
			type: "get",
			dataType: "jsonp",
			async : false,
			jsonp: "callback",
			success: function (data) {
				var province = data.result.addressComponent.province;
				var cityname = (data.result.addressComponent.city);
				var district = data.result.addressComponent.district;
				var street = data.result.addressComponent.street;
				var street_number = data.result.addressComponent.street_number;
				var formatted_address = data.result.formatted_address;
				var data = {
					latitude: latitude,
					longitude: longitude,
					cityname: cityname
				};
				$("#cityName").val(cityname);
			},
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                alert('error');
	            alert(XMLHttpRequest.status);
	            alert(XMLHttpRequest.readyState);
	            alert(textStatus);
            } 
		});
	}
</script>
</html>